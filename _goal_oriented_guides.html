<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Documentation for Cloudera-Labs</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="_goal_oriented_guides" class="book toc2 toc-left">
<div id="header">
<h1>Documentation for Cloudera-Labs</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="README.html">Documentation for Cloudera-Labs</a></span></p><ul class="sectlevel1">
<li><a href="_introduction_and_user_orientation.html">1. Introduction and user-orientation</a>
</li>
<li><a href="_learning_oriented_training.html">2. Learning-oriented Training</a>
</li>
<li><a href="_goal_oriented_guides.html"><span class="toc-current">3. Goal-oriented Guides</span></a>
<ul class="sectlevel2">
<li><a href="_goal_oriented_guides.html#cdDevelopersSetup">3.1. Detailed Setup for Developers</a>
<ul class="sectlevel3">
<li><a href="_goal_oriented_guides.html#_developers_setup_on_osx">3.1.1. Developers setup on OSX</a>
</li>
<li><a href="_goal_oriented_guides.html#_developer_setup_on_windows">3.1.2. Developer setup on Windows</a>
</li>
</ul>
</li>
<li><a href="_goal_oriented_guides.html#_process_guides">3.2. Process Guides</a>
<ul class="sectlevel3">
<li><a href="_goal_oriented_guides.html#_main_setup_process">3.2.1. Main Setup Process</a>
</li>
<li><a href="_goal_oriented_guides.html#_refresh_your_cloudera_deploy_local_repo">3.2.2. Refresh your Cloudera-Deploy local repo</a>
</li>
<li><a href="_goal_oriented_guides.html#_manual_ansible_controller_setup_on_centos7">3.2.3. Manual Ansible Controller setup on Centos7</a>
</li>
<li><a href="_goal_oriented_guides.html#_install_homebrew_and_git_on_osx">3.2.4. Install Homebrew and Git on OSX</a>
</li>
<li><a href="_goal_oriented_guides.html#_setup_docker">3.2.5. Setup Docker</a>
</li>
<li><a href="_goal_oriented_guides.html#_install_windows_subsystem_for_linux_wsl2">3.2.6. Install Windows Subsystem for Linux (WSL2)</a>
</li>
<li><a href="_goal_oriented_guides.html#_handle_line_endings_on_windows">3.2.7. Handle line-endings on Windows</a>
</li>
<li><a href="_goal_oriented_guides.html#_setup_gpg_commit_signing">3.2.8. Setup GPG commit signing</a>
</li>
<li><a href="_goal_oriented_guides.html#_using_the_ansible_runner_independent_of_cloudera_deploy">3.2.9. Using the Ansible Runner Independent of Cloudera-Deploy</a>
</li>
<li><a href="_goal_oriented_guides.html#_getting_started_with_developing_collections">3.2.10. Getting Started with Developing Collections</a>
</li>
<li><a href="_goal_oriented_guides.html#_install_dependencies_without_using_runner">3.2.11. Install Dependencies without using Runner</a>
</li>
<li><a href="_goal_oriented_guides.html#_developing_within_the_runner">3.2.12. Developing within the Runner</a>
</li>
<li><a href="_goal_oriented_guides.html#_working_with_aws_sso">3.2.13. Working with AWS SSO</a>
</li>
<li><a href="_goal_oriented_guides.html#_using_a_jumpbox">3.2.14. Using a Jumpbox</a>
</li>
</ul>
</li>
<li><a href="_goal_oriented_guides.html#_troubleshooting">3.3. Troubleshooting</a>
<ul class="sectlevel3">
<li><a href="_goal_oriented_guides.html#_ansible_vs_cloudera_cluster">3.3.1. Ansible vs cloudera.cluster</a>
</li>
<li><a href="_goal_oriented_guides.html#_credentials">3.3.2. Credentials</a>
</li>
<li><a href="_goal_oriented_guides.html#_general_troubleshooting">3.3.3. General Troubleshooting</a>
</li>
</ul>
</li>
<li><a href="_goal_oriented_guides.html#cdPrivate">3.4. CDP Private Cloud Deployments</a>
<ul class="sectlevel3">
<li><a href="_goal_oriented_guides.html#_ansible_controller_options">3.4.1. Ansible Controller options</a>
</li>
<li><a href="_goal_oriented_guides.html#_inventories">3.4.2. Inventories</a>
</li>
<li><a href="_goal_oriented_guides.html#_process_overview">3.4.3. Process Overview</a>
</li>
<li><a href="_goal_oriented_guides.html#_executing_playbooks">3.4.4. Executing Playbooks</a>
</li>
</ul>
</li>
<li><a href="_goal_oriented_guides.html#Contributing">3.5. Contributing to these Docs</a>
</li>
</ul>
</li>
<li><a href="_information_oriented_references.html">4. Information-oriented References</a>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_goal_oriented_guides"><a class="anchor" href="#_goal_oriented_guides"></a><a class="link" href="#_goal_oriented_guides">3. Goal-oriented Guides</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="cdDevelopersSetup"><a class="anchor" href="#cdDevelopersSetup"></a><a class="link" href="#cdDevelopersSetup">3.1. Detailed Setup for Developers</a></h3>
<div class="paragraph">
<p>This document is structured with suggested sequences of steps at the top, and the various processes you need underneath. Use the suggested sequences or create your own as appropriate.</p>
</div>
<div class="paragraph">
<p>Many of the Processes in here have been come to over years of trying different approaches, in the main our philosophy has been to adopt the least-worst option, minimising user surprise in the least number of the simplest possible steps, even if that results in a more complex implementation for us in code where few users ever tread.</p>
</div>
<div class="paragraph">
<p>We welcome all suggestions and discussions for improvement, but if you&#8217;re going to tell us we&#8217;re 'using Docker Wrong' then we&#8217;d greatly appreciate an explanation on how you&#8217;d improve it.</p>
</div>
<div class="sect3">
<h4 id="_developers_setup_on_osx"><a class="anchor" href="#_developers_setup_on_osx"></a><a class="link" href="#_developers_setup_on_osx">3.1.1. Developers setup on OSX</a></h4>
<div class="paragraph">
<p>The Developer onboarding is aimed at those who want to modify the automation tooling itself to change behaviors.</p>
</div>
<div class="olist arabic">
<div class="title">The following chapters of this documentation provide the necessary process:</div>
<ol class="arabic">
<li>
<p>Prepare your <a href="_goal_oriented_guides.html#_install_homebrew_and_git_on_osx">OSX Deps</a></p>
</li>
<li>
<p>Follow the <a href="_goal_oriented_guides.html#_main_setup_process">Main Setup</a></p>
</li>
<li>
<p>(Optional) Setup <a href="_goal_oriented_guides.html#_setup_gpg_commit_signing">Commit Signing</a> for Contributions</p>
</li>
<li>
<p>(Optional) Get setup to Develop the <a href="_goal_oriented_guides.html#_getting_started_with_developing_collections">Collections</a> themselves</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_developer_setup_on_windows"><a class="anchor" href="#_developer_setup_on_windows"></a><a class="link" href="#_developer_setup_on_windows">3.1.2. Developer setup on Windows</a></h4>
<div class="paragraph">
<p>Because Windows already needs to set up Linux compatibility to make containers work, we’re just going to leverage that across the board for simplicity.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
You must use WSL2 or you are going to get some really weird errors.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We assume you have a recent version of 64bit Windows 10 with Administrator access and virtualization enabled, if you are restricted by your org from doing this then they should have a replacement process as this is pretty standard stuff for developers.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install <a href="_goal_oriented_guides.html#_install_windows_subsystem_for_linux_wsl2">WSL2</a></p>
</li>
<li>
<p>Handle <a href="_goal_oriented_guides.html#_handle_line_endings_on_windows">Line Endings</a> on Windows</p>
</li>
<li>
<p>Follow the <a href="_goal_oriented_guides.html#_main_setup_process">Main Setup</a></p>
</li>
<li>
<p>(Optional) Setup <a href="_goal_oriented_guides.html#_setup_gpg_commit_signing">Commit Signing</a> for Contributions</p>
</li>
<li>
<p>(Optional) Get setup to Develop the <a href="_goal_oriented_guides.html#_getting_started_with_developing_collections">Collections</a> themselves</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_process_guides"><a class="anchor" href="#_process_guides"></a><a class="link" href="#_process_guides">3.2. Process Guides</a></h3>
<div class="sect3">
<h4 id="_main_setup_process"><a class="anchor" href="#_main_setup_process"></a><a class="link" href="#_main_setup_process">3.2.1. Main Setup Process</a></h4>
<div class="paragraph">
<p>This Setup Process is simply the <a href="https://github.com/cloudera-labs/cloudera-deploy/blob/main/readme.adoc#2-quickstart">Quickstart</a> from the Cloudera-Deploy Readme with more steps and explanations.</p>
</div>
<div class="sect4">
<h5 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a><a class="link" href="#_prerequisites">Prerequisites</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It is easiest to test your credentials within the Runner, as the dependencies are already installed for you
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Cloud Credentials (CDP Public) and/or Host Infrastructure (CDP Private)</p>
<div class="ulist">
<ul>
<li>
<p>If you are deploying to a public cloud, you will need an active credential for that provider with rights to deploy resources for the Deployment you specify.</p>
</li>
<li>
<p>Unless otherwise instructed your ‘default’ credential will be used for the cloud provider.</p>
</li>
<li>
<p>You can check this with <code>aws sts get-caller-identity</code> and comparing outputs to the AWS UI, if using AWS</p>
</li>
<li>
<p>For Azure, consider <code>az account list</code>, or if you need to refresh your credentials, <code>az login</code>.</p>
</li>
<li>
<p>For GCP, check that your Service Account credential is being picked up in the Cloudera Deploy Profile, and then test with <code>gcloud auth list</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>CDP Credentials (CDP Public)</p>
<div class="ulist">
<ul>
<li>
<p>If you are deploying CDP Public Cloud, you will need an active credential within a CDP Tenant.</p>
</li>
<li>
<p>Unless otherwise instructed, your ‘default’ credential and tenant will be used.</p>
</li>
<li>
<p>You can check this with <code>cdp iam get-user</code> and comparing outputs to the CDP UI</p>
</li>
</ul>
</div>
</li>
<li>
<p>Code Deps:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Docker and Git installed locally (quick option)(<a href="_goal_oriented_guides.html#_setup_docker">See Setup Docker</a>)</p>
</li>
<li>
<p>or - Ability to install Python and CLI dependencies on the machine of your choice (slow option)(See <a href="_goal_oriented_guides.html#_manual_ansible_controller_setup_on_centos7">Centos7 Script</a> for an example)</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_get_the_repo"><a class="anchor" href="#_get_the_repo"></a><a class="link" href="#_get_the_repo">Get the Repo</a></h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a terminal and switch to your preferred projects directory</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cd ~/Projects</code></pre>
</div>
</div>
</li>
<li>
<p>Clone or update the repo</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">git clone https://github.com/cloudera-labs/cloudera-deploy.git &amp;&amp; cd cloudera-deploy &amp;&amp; chmod +x ./quickstart.sh</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you already have the repo cloned, don’t forget to <a href="_goal_oriented_guides.html#_refresh_your_cloudera_deploy_local_repo">update it</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_get_the_runner"><a class="anchor" href="#_get_the_runner"></a><a class="link" href="#_get_the_runner">Get the Runner</a></h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Have <a href="_goal_oriented_guides.html#_setup_docker">Docker</a> Installed and running</p>
</li>
<li>
<p>(Optional) Set your provider to download a reduced image and save disk space</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>AWS</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">export provider=aws</code></pre>
</div>
</div>
</li>
<li>
<p>Azure</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">export provider=azure</code></pre>
</div>
</div>
</li>
<li>
<p>GCP</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">export provider=gcp</code></pre>
</div>
</div>
</li>
<li>
<p>Default is all of them, but it’s a ~2.3GB image download</p>
</li>
</ol>
</div>
</li>
<li>
<p>Run the quickstart script in the Repo you just cloned above</p>
<div class="ulist">
<ul>
<li>
<p>Option A: Run the quickstart bare, it will mount the parent directory of the cloudera-deploy repo, which will be your code directory if you followed the directions above, e.g. <code>~/Projects</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">./quickstart.sh</code></pre>
</div>
</div>
</li>
<li>
<p>Option B: Include an explicit path on your local machine, it will be mounted in the /runner/project folder in the container. If your code or Definitions are not in this path you may not be able to access them in the container.</p>
</li>
<li>
<p>Don’t worry if you get it wrong, just <strong>stop the container</strong> and rerun quickstart and it’ll make a new one with the new mount.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">./quickstart.sh ~/code</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>This will drop you into a new shell in the container with all dependencies resolved for working with CDP and Cloud Infrastructure, you&#8217;ll know it has worked because the shell prompt is Orange with <code>cldr &lt;version&gt; #&gt;</code></p>
<div class="ulist">
<ul>
<li>
<p>It will automatically load your local machine user profile so you have access to your credentials, ssh keys, etc.</p>
</li>
<li>
<p>If you run the quickstart script again, it’ll simply create another bash session on the container, providing useful parallelism</p>
</li>
<li>
<p>If you stop the container, the next time you run quickstart it will be updated and recreated, so any changes within the container filesystem and not persisted back to your Project directory or mounted user profile will be lost</p>
</li>
<li>
<p>As long as you run commands from within the /runner path, it will log your Ansible back to ~/.config/cloudera-deploy/log</p>
</li>
</ul>
</div>
</li>
<li>
<p>If you already have a CDP Credential in your local user profile, you can test it with</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cdp iam get-user</code></pre>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>It will use the default CDP credential, or you can use a different profile by setting the CDP_PROFILE environment variable, or setting cdp_profile in your cloudera-deploy Definition files.</p>
</li>
<li>
<p>You should compare the UUID of your user returned by this command in the terminal with the UUID of your user reported in the User Profile in the CDP UI so you are certain that you are deploying to the expected Tenant</p>
</li>
</ol>
</div>
</li>
<li>
<p>Check you have a credential for your chosen Cloud Infrastructure Provider. The default is AWS, and again you can provide a specific profile or use your default. You can check it by running</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">aws sts get-caller-identity</code></pre>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>You should likewise compare the Account ID reported here with the Account ID in the AWS IAM UI to ensure you are targeting the expected Account. This is similar for other providers.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_prepare_your_profiles_to_run_a_deployment"><a class="anchor" href="#_prepare_your_profiles_to_run_a_deployment"></a><a class="link" href="#_prepare_your_profiles_to_run_a_deployment">Prepare your Profiles to run a Deployment</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
that you should execute any Ansible commands from /runner in the Runner, as it has all the defaults set for you and it may fail to find dependencies otherwise.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you have different settings for different deployments you can create additional profile files under the directory above to store the different configurations. To use an alternative cloudera-deploy profile, specify the <code>-e profile=&lt;profile_name&gt;</code> option when running the ansible-playbook command.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Edit the default user Profile to personalise the Password, Namespace, SSH Keys, etc. for your Deployments. Note that this file is created the first time you run the quickstart.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">vi ~/.config/cloudera-deploy/profiles/default</code></pre>
</div>
</div>
</li>
<li>
<p>You will need CDP Credentials, and Credentials for your target Infrastructure of choice. Fortunately the Runner has most of these dependencies available to you</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>CDP with pre-issued Keys and optional profile</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cdp configure --profile default</code></pre>
</div>
</div>
</li>
<li>
<p>AWS with pre-issued Keys</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">aws configure --profile default</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>AWS SSO requires awscliv2 which is not installed in the Runner by default</p>
</li>
</ul>
</div>
</li>
<li>
<p>Azure via interactive login</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">az login</code></pre>
</div>
</div>
</li>
<li>
<p>Google Cloud via init</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">gcloud init</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_deployment_run_commands"><a class="anchor" href="#_deployment_run_commands"></a><a class="link" href="#_deployment_run_commands">Deployment Run Commands</a></h5>
<div class="paragraph">
<p>Provided you have completed the prerequisites to set up a cloud provider credential, and CDP Public Cloud credential, and your Cloudera-Deploy Profile, the following command creates a default Sandbox with CDP Public &amp; Private Cloud in your default CDP Tenant and Cloud Infra Provider with no further interaction from the user:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ansible-playbook project/cloudera-deploy/main.yml -e "definition_path=examples/sandbox" -t run,default_cluster</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
So that is three dependencies, and two commands, and you have a complete Hybrid Cloud Data Platform
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The command is structured typically for an ansible-playbook.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you have used quickstart.sh to mount a local project directory with your definitions.yml and application.yml into the runner container (as explained in the steps in Get the Runner above), then you won’t have your own main.yml close to hand. You can instead use the default main.yml in /opt/cloudera-deploy/, and reference your project dir at /runner/project:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ansible-playbook /opt/cloudera-deploy/main.yml -e "definition_path=/runner/project/&lt;your definition path&gt;" -t &lt;your tags&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Note that we pass in some ansible 'extra variables' using the -e flag. The only required variable points to the definition_path which contains the files that describe the deployment you want. You can provide many more extra vars, or even files directly on the command-line per usual Ansible options.</p>
</li>
<li>
<p>Note that we pass in Ansible Tags with <code>-t</code>, in this case the tags instruct Cloudera-Deploy to build CDP Public Cloud to the 'Runtimes' level, and also deploy a 'default' or basic CDP Base Cluster on EC2 machines in the same VPC. There are many other tags that may be used to control behavior, and are explained elsewhere.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Here are additional commands which will come in handy:</div>
<ul>
<li>
<p>Teardown and delete everything related to this definition:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ansible-playbook project/cloudera-deploy/main.yml -e "definition_path=examples/sandbox" -t teardown</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
This will <code>teardown</code> everything related to this definition and name_prefix, make sure that is actually what you want to be doing before running it.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Just deploy a CDP Public Datalake:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ansible-playbook project/cloudera-deploy/main.yml -e "definition_path=examples/sandbox" -t plat</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This uses the same definition, but then uses a different Ansible Tag to only deploy part of it, more explanation of the Definitions and Tags will follow elsewhere in the Architecture Docs.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Just deploy CDP Private Cluster Trial on Public Cloud Infra:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ansible-playbook project/cloudera-deploy/main.yml -e "definition_path=examples/sandbox" -t infra,default_cluster</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This leverages the dynamic inventory feature to make a simple cluster on EC2 instances on AWS without the user needing to learn how first, and is very handy for trials and platform testing
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_refresh_your_cloudera_deploy_local_repo"><a class="anchor" href="#_refresh_your_cloudera_deploy_local_repo"></a><a class="link" href="#_refresh_your_cloudera_deploy_local_repo">3.2.2. Refresh your Cloudera-Deploy local repo</a></h4>
<div class="paragraph">
<p>If you have previously used Cloudera-Deploy but haven’t touched it in a while, here is a guide to refreshing your setup and getting results quickly</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cd cloudera-deploy
git fetch --all
git pull
docker stop $(docker ps -qa)
./quickstart.sh
cdp iam get-user
aws iam get-user</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_manual_ansible_controller_setup_on_centos7"><a class="anchor" href="#_manual_ansible_controller_setup_on_centos7"></a><a class="link" href="#_manual_ansible_controller_setup_on_centos7">3.2.3. Manual Ansible Controller setup on Centos7</a></h4>
<div class="paragraph">
<p>We provide an example script for initialising an Ansible Controller on a Centos7 box <a href="https://github.com/cloudera-labs/cloudera-deploy/blob/main/centos7-init.sh">here</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_install_homebrew_and_git_on_osx"><a class="anchor" href="#_install_homebrew_and_git_on_osx"></a><a class="link" href="#_install_homebrew_and_git_on_osx">3.2.4. Install Homebrew and Git on OSX</a></h4>
<div class="listingblock">
<div class="title">Install XCode command line tools</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">xcode-select --install</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Install Homebrew</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Install git (through Homebrew)</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">brew install git</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are going to use AWS SSO, you may also with to install awscliv2 on your local machine</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">brew install awscli@2</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setup_docker"><a class="anchor" href="#_setup_docker"></a><a class="link" href="#_setup_docker">3.2.5. Setup Docker</a></h4>
<div class="paragraph">
<div class="title">Guide for Windows</div>
<p>Follow the instructions provided by <a href="https://docs.docker.com/docker-for-windows/install/">Docker</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You want to be using WSL2, make sure Docker can see the underlying Ubuntu (or similar) for execution. You are advised to stick to the guide here, as we have found Windows throws some intractable filesystem and networking errors with creative linux-on-Windows setups for Docker and SSH.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Guide for OSX</div>
<p>Follow the instructions provided by <a href="https://docs.docker.com/docker-for-mac/install/">Docker</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_install_windows_subsystem_for_linux_wsl2"><a class="anchor" href="#_install_windows_subsystem_for_linux_wsl2"></a><a class="link" href="#_install_windows_subsystem_for_linux_wsl2">3.2.6. Install Windows Subsystem for Linux (WSL2)</a></h4>
<div class="olist arabic">
<div class="title">There’s a lot of guides on how to do this, here’s a summary:</div>
<ol class="arabic">
<li>
<p>Enable Developer mode (on older versions of Win10)</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Windows Settings &gt; Update &amp; Security</p>
</li>
<li>
<p>Select the Developer Mode radio button</p>
</li>
<li>
<p>You may not need to do this, don’t worry if it’s not there and the rest of the process works, as the latest releases don’t require you to do this to install Linux</p>
</li>
<li>
<p>If you did have to enable it, you may have to reboot (yay Windows)</p>
</li>
</ol>
</div>
</li>
<li>
<p>Enable Windows Subsystem for Linux v2</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Control Panel &gt; Programs &amp; Features &gt; Turn Windows Features on and off</p>
</li>
<li>
<p>Tick the box for ‘Windows Subsystem for Linux’</p>
</li>
<li>
<p>Make sure you either setup WSL2 from the start, or do the upgrade process. WSL1 has some strange behaviors</p>
</li>
<li>
<p>You’ll probably have to reboot. Yay Windows!</p>
</li>
</ol>
</div>
</li>
<li>
<p>Install Ubuntu 18 (other distros untested, including Ubuntu 20)</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Try to do it from the Microsoft Store</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Open the store (search store in launch bar)</p>
</li>
<li>
<p>Search for ‘Linux’ in the store</p>
</li>
<li>
<p>Select and install Ubuntu</p>
</li>
</ol>
</div>
</li>
<li>
<p>If you can’t do it from the store, try this in the cmd.exe prompt <code>lxrun /install</code></p>
</li>
<li>
<p>It’ll ask you to set a username and password, keep it short and simple, doesn’t have to match your actual Windows user</p>
</li>
</ol>
</div>
</li>
<li>
<p>You may have to set this as the default bash environment as Docker for Windows likes to steal it away after updates</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>List the currently installed distros by opening cmd.exe</p>
</li>
<li>
<p><code>wsl --list --all</code></p>
</li>
<li>
<p>Set ubuntu as default if it is not</p>
</li>
<li>
<p><code>wsl -s Ubuntu</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_handle_line_endings_on_windows"><a class="anchor" href="#_handle_line_endings_on_windows"></a><a class="link" href="#_handle_line_endings_on_windows">3.2.7. Handle line-endings on Windows</a></h4>
<div class="paragraph">
<p>Windows defaults to a different line ending standard than Linux/OSX.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You only need to follow this step if you plan on editing the code on Windows.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Cloudera Labs repos standardise on linux line endings, the easiest way to handle this on Windows involves basically two steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set git to always not use Windows line endings, so it doesn’t rewrite your files when you checkout</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>git config --global core.autocrlf false</code></p>
</li>
<li>
<p>Set your IDE to use Linux line endings, if not for everything then at least the Cloudera Labs projects</p>
</li>
<li>
<p>In Pycharm, this is in File &gt; Settings &gt; Editor &gt; Code Style &gt; General &gt; Line Separator: set to ‘Unix and macOS (\n)</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_setup_gpg_commit_signing"><a class="anchor" href="#_setup_gpg_commit_signing"></a><a class="link" href="#_setup_gpg_commit_signing">3.2.8. Setup GPG commit signing</a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can skip this step if you are not planning on contributing code
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">DCO:</div>
<p>Cloudera-Labs uses the Developer Certificate of Origin (DCO) approach to open source contribution, by signing your commits you are attesting that you are allowed to submit them by whoever owns your work (you, or your employer). We also require commit signing to validate the supply chain on our code.</p>
</div>
<div class="paragraph">
<div class="title">Background:</div>
<p>There is a good explanation <a href="https://nifi.apache.org/gpg.html">here</a>, it also covers setup for machines with other OS.</p>
</div>
<div class="paragraph">
<p>This subguide assumes that you want to set up your development machine so that it automatically signs all your commits without bothering you too much. If you are just checking out the code to inspect it and not for contributing back to the community, then you can skip this step.
You may want to modify this process to ask you for your passphrase or manually sign commits each time at your preference.</p>
</div>
<div class="paragraph">
<div class="title">References:</div>
<p><a href="https://nifi.apache.org/gpg.html" class="bare">https://nifi.apache.org/gpg.html</a> <br>
<a href="https://stackoverflow.com/a/46884134" class="bare">https://stackoverflow.com/a/46884134</a> <br>
<a href="https://superuser.com/a/954536" class="bare">https://superuser.com/a/954536</a> <br>
<a href="https://withblue.ink/2020/05/17/how-and-why-to-sign-git-commits.html" class="bare">https://withblue.ink/2020/05/17/how-and-why-to-sign-git-commits.html</a> <br></p>
</div>
<div class="paragraph">
<div class="title">Testing:</div>
<p>OSX Catalina 10.15.7 on MacBook Pro 2019</p>
</div>
<div class="olist arabic">
<div class="title">Process:</div>
<ol class="arabic">
<li>
<p>Update or install <a href="_goal_oriented_guides.html#_install_homebrew_and_git_on_osx">Homebrew</a></p>
</li>
<li>
<p>Install dependencies</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">brew install gpg2 pinentry-mac &amp;&amp; brew install --cask gpg-suite</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>gpg-suite is not strictly necessary, but it makes it easier to integrate signing with IDEs like IntelliJ as it helps you manage the passphrase in your OSX keychain</p>
</li>
<li>
<p>Pinentry-mac makes it easy to sign commits within your IDE, like Pycharm, without having to always commit via terminal</p>
</li>
</ul>
</div>
</li>
<li>
<p>Create a directory for gnupg to store details</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">mkdir ~/.gnupg</code></pre>
</div>
</div>
</li>
<li>
<p>Put the following in <code>~/.gnupg/gpg-agent.conf</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">default-cache-ttl 600
max-cache-ttl 7200
default-cache-ttl-ssh 600
max-cache-ttl-ssh 7200
pinentry-program /usr/local/bin/pinentry-mac</code></pre>
</div>
</div>
</li>
<li>
<p>Enable it in your user profile such as ~/.bash_profile or ~/.zprofile</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">export GPG_TTY=$(tty)
gpgconf --launch gpg-agent</code></pre>
</div>
</div>
</li>
<li>
<p>Set correct permissions on your gnupg user directory</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">chown -R $(whoami) ~/.gnupg/
find ~/.gnupg -type f -exec chmod 600 {} \;
find ~/.gnupg -type d -exec chmod 700 {} \;</code></pre>
</div>
</div>
</li>
<li>
<p>Generate yourself a key</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">gpg --full-gen-key</code></pre>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Key type 4</p>
</li>
<li>
<p>Keysize 4096</p>
</li>
<li>
<p>Expiration 1y or 2y or whatever</p>
</li>
<li>
<p>Your real name, or github username</p>
</li>
<li>
<p>Your real email address, or the one github recognises as yours in your Settings</p>
</li>
<li>
<p>A Passphrase - don’t forget it, and make sure it is strong</p>
</li>
</ol>
</div>
</li>
<li>
<p>Verify your key is created and stored</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">gpg2 --list-secret-keys --keyid-format SHORT</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Copy your key ID, it’ll look something like <code>rsa4096/674CB45A</code></p>
</li>
<li>
<p>You want the second bit, <code>674CB45A</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Test your key can be used</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">echo "hello world" | gpg2 --clearsign</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You’ll have to enter your passphrase to sign it, then it’ll print the encrypted message</p>
</li>
</ul>
</div>
</li>
<li>
<p>You may want to add multiple email addresses to the key signing, such as your open source email and/or your employer email and/or your personal email</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Open your key for editing</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">gpg2 --edit-key &lt;your ID here&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Then use the adduid command</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">adduid</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the identity Name and Email as before</p>
</li>
<li>
<p>Then update the trust for the new identity</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">uid 2
trust</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You probably want trust 5</p>
</li>
</ul>
</div>
</li>
<li>
<p>Save to exit</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">save</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Configure Github to recognise your signed commits</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Set your git email for making commits</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">git config --global user.email &lt;your@email.com&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>This email must be one of those in your GPG key set earlier</p>
</li>
</ul>
</div>
</li>
<li>
<p>Export your public key for uploading to Github</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">gpg2 --armor --export &lt;your ID here&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Copy everything including the following lines into your paste buffer</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">-----BEGIN PGP PUBLIC KEY BLOCK-----
…
-----END PGP PUBLIC KEY BLOCK-----</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Open github and go to your key settings
<a href="https://github.com/settings/keys" class="bare">https://github.com/settings/keys</a></p>
</li>
<li>
<p>Add new GPG key, paste in your PGP block from your buffer</p>
</li>
<li>
<p>Configure git to autosign your commits</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">git config --global gpg.program gpg
git config --global user.signingkey &lt;your ID here&gt;
git config --global commit.gpgSign true
git config --global tag.gpgSign true</code></pre>
</div>
</div>
</li>
<li>
<p>Put the following in ~/.gnupg/gpg.conf</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># Enable notty for IDE signing
no-tty
# Enable gpg to use the gpg-agent
use-agent</code></pre>
</div>
</div>
</li>
<li>
<p>Configure IntelliJ to sign your commits</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>This should be as simple as restarting your IDE once this process is complete</p>
</li>
<li>
<p>Then when you make a new commit you can tick the box to ‘Sign-off commit’ in the dialog box</p>
</li>
</ol>
</div>
</li>
<li>
<p>Configure vsCode to sign commits</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Find the following flag in the config and enable it <code>git.enableCommitSigning</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_ansible_runner_independent_of_cloudera_deploy"><a class="anchor" href="#_using_the_ansible_runner_independent_of_cloudera_deploy"></a><a class="link" href="#_using_the_ansible_runner_independent_of_cloudera_deploy">3.2.9. Using the Ansible Runner Independent of Cloudera-Deploy</a></h4>
<div class="paragraph">
<p>In order to minimise time spent on dependency management and troubleshooting issues arising from users on different systems, we provide a standardised container image.
The image is prepared in such a way that you can use it as a shell, a python environment, a container on Kubernetes, within other CICD Frameworks, Ansible Tower, or simply as an ansible-runner.</p>
</div>
<div class="ulist">
<div class="title">Testing:</div>
<ul>
<li>
<p>OSX Catalina 10.15.7 on MacBook Pro 2019</p>
</li>
<li>
<p>Windows 10.0.19042 on Intel gaming rig (Tasteful RGB Edition)</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Manual Process:</div>
<ol class="arabic">
<li>
<p>To run this process on Windows you are expected to be within your <a href="_goal_oriented_guides.html#_install_windows_subsystem_for_linux_wsl2">WSL2</a> subsystem</p>
</li>
<li>
<p>Clone the Cloudera Labs Ansible Runner implementation repo into your preferred local Projects directory</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">git clone https://github.com/cloudera-labs/cldr-runner.git &amp;&amp; cd cldr-runner</code></pre>
</div>
</div>
</li>
<li>
<p>Linux only: Mark the run_project.sh script and build.sh script as executable</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">chmod +x ./run_project.sh
chmod +x ./build.sh</code></pre>
</div>
</div>
</li>
<li>
<p>Ensure <a href="_goal_oriented_guides.html#_setup_docker">Docker</a> is running on your host machine</p>
</li>
<li>
<p>Copy the absolute path to the root of your code projects directory that contains the projects you want to execute within the container environment, e.g. <code>/Users/dchaffelson/Projects</code></p>
</li>
<li>
<p>Launch the runner targeting the project you want to execute by passing the absolute path as the argument to the run_project.sh script, e.g. <code>./run_project.sh /Users/dchaffelson/Projects</code></p>
<div class="ulist">
<ul>
<li>
<p>The script will build the container image from the latest release bits, this will take a few minutes the first time, the resulting image will be ~2GB</p>
</li>
<li>
<p>You will then be dropped into a shell session in directory /runner in the container environment. Your Project will be mounted at /runner/project. You will have all the currently known dependencies for working with CDP pre-installed with conflicts resolved</p>
</li>
<li>
<p>Note that the container must be stopped for a new project directory to be mounted to a new build, if there is already a container of the same name running you will just get a new shell session in it</p>
</li>
</ul>
</div>
</li>
<li>
<p>At this point you may wish to install additional dependencies to the container, particularly those which may be behind VPN or on your corporate VCS.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ansible-galaxy install -r project/deps/ansible-deps.yml
pip install -r project/deps/python-deps.txt</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
By default, the container is recreated if stopped, but it will not stop if you close your shell session as it is held open by a background tty. Try not to kill that.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_getting_started_with_developing_collections"><a class="anchor" href="#_getting_started_with_developing_collections"></a><a class="link" href="#_getting_started_with_developing_collections">3.2.10. Getting Started with Developing Collections</a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can skip this step if you only want to use the Collections to create your own playbooks. <br>
This step is setting up the to Develop the Collections themselves.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will guide you through setting up a directory structure convenient for developing and executing the Collections within the Runner, or other execution environments.</p>
</div>
<div class="paragraph">
<p>You only need to do this if you want to contribute directly to the Collections or Python clients underlying the interactions with Cloudera products - you do not need to go through this setup process if you simply wish to use cloudera-deploy with your own YAML Definitions, as the Collections and Clients should not need to be modified in those cases and are already pre-installed in the Runner.</p>
</div>
<div class="paragraph">
<div class="title">Why do it this way:</div>
<p>Ansible expects to find collections within a path ‘collections/ansible_collections’ on a series of predefined or default paths within your environment. By default, the Runner has this Path variable prepopulated in a helpful fashion to the pre-installed Collections, this process guides you through modifying that to point at your own versions which you have to maintain yourself.</p>
</div>
<div class="paragraph">
<p>For development purposes, creating this path in your favourite coding Projects directory, and then checking out the collections under it and renaming them to match the expected namespace may seem slightly arcane but it is the lowest-friction method for ongoing development we have found over many years of doing this.</p>
</div>
<div class="olist arabic">
<div class="title">Process:</div>
<ol class="arabic">
<li>
<p>Make the directory tree Ansible expects in the same parent code directory that cloudera-deploy is in, e.g.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cd cloudera-deploy &amp;&amp; mkdir -p ../ansible_dev/collections/ansible_collections/cloudera</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>cloudera is the base namespace of our collection</p>
</li>
<li>
<p>Your Projects directory should also have your Ansible Playbooks and other codebase in it, so that you can mount the root of it to the Runner and have access to all your codebase, e.g. <code>~/Projects/cloudera-deploy</code> should be where Cloudera-Deploy is located</p>
</li>
</ul>
</div>
</li>
<li>
<p>Fork each of the sub-collections and cdpy into your personal github, and replace &lt;myAccount&gt; with your actual github account below</p>
</li>
<li>
<p>Checkout each of the sub-collections into this folder, e.g.:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cd ~/Projects
git clone -b devel https://github.com/&lt;myAccount&gt;/cdpy.git cdpy
cd ansible_dev/collections/ansible_collections/cloudera
git clone -b devel https://github.com/&lt;myAccount&gt;/cloudera.exe.git exe
git clone -b devel https://github.com/&lt;myAccount&gt;/cloudera.cloud.git cloud
git clone -b devel https://github.com/&lt;myAccount&gt;/cloudera.cluster.git cluster</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The cloned directories above must be named "exe", "cloud" and "cluster", respectively. Ensure you specify the directory name as the last parameter in the command line, as shown above.
Each of the subcollections should be on the ‘devel’ branch so you can PR them back them with your changes
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Your Code Project directory should now look something like this:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">/Projects/ansible_dev/collections/ansible_collections/cloudera
/Projects/ansible_dev/collections/ansible_collections/cloudera/exe
/Projects/ansible_dev/collections/ansible_collections/cloudera/cloud
/Projects/ansible_dev/collections/ansible_collections/cloudera/cluster
/Projects/cdpy
/Projects/cloudera-deploy</code></pre>
</div>
</div>
</li>
<li>
<p>Before you invoke quickstart.sh, set the environment variable below to tell Ansible where to find your code inside your execution environment once it is mounted in the Container at /runner/project:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">export CLDR_COLLECTION_PATH="ansible_dev/collections"
export CLDR_PYTHON_PATH=/runner/project/cdpy/src</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You might want to set this in your bash or zsh profile on your local machine so it is persistent
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Then, when you run quickstart.sh in cloudera-deploy, it will pick up this extra Collection location and add cdpy to the PYTHONPATH, and use these instead of the release versions basked into the Container</p>
</li>
<li>
<p>You can confirm this is working by running this inside the Runner</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ansible-galaxy collection list</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>It should look something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># /runner/project/ansible_dev/collections/ansible_collections
Collection       Version
---------------- -------
cloudera.cloud   0.1.0
cloudera.cluster 2.0.0
cloudera.exe     0.0.1
Cloudera.runtime 0.0.1

# /home/runner/.ansible/collections/ansible_collections
Collection           Version
-------------------- -------
amazon.aws           1.4.0
ansible.netcommon    1.5.0
ansible.posix        1.1.1
azure.azcollection   1.4.0
community.aws        1.4.0
community.crypto     1.4.0
community.general    2.1.1
community.mysql      1.2.0
community.postgresql 1.1.1
google.cloud         1.0.2
netapp.azure         21.3.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you see duplication of collections because you are using the runner AND mounting your own versions, you probably have not activated the CLDR_COLLECTION_PATH variable correctly, and thus quickstart.sh is not picking it up.</p>
</div>
<div class="paragraph">
<p>As another test, you should also be able to invoke python inside the container and use cdpy</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from cdpy.cdpy import Cdpy
c = Cdpy()
c.iam.get_user()</code></pre>
</div>
</div>
<div class="paragraph">
<p>To test that cdpy is present and you can access your account as on cmdline</p>
</div>
<div class="paragraph">
<p>You may now edit the collections or cdpy and have the changes immediately available for use within the Runner, which is an awful lot easier than having to compile and crossload them after every change.</p>
</div>
</div>
<div class="sect3">
<h4 id="_install_dependencies_without_using_runner"><a class="anchor" href="#_install_dependencies_without_using_runner"></a><a class="link" href="#_install_dependencies_without_using_runner">3.2.11. Install Dependencies without using Runner</a></h4>
<div class="paragraph">
<p>We prefer that you use the Runner, because it sets many defaults to avoid common issues and thus save you and us a lot of issue reproduction time. However, we understand that there are many situations where it may not be appropriate, such as air-gapped environments, or when you want to run the install locally on the hardware and not have a separate ansible controller.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new virtualenv, or activate an existing one, we do not recommend installing dependencies in system python on most OS.</p>
</li>
<li>
<p>Install dependencies for your hosting infrastructure version following the pathway laid out in the <a href="https://github.com/cloudera-labs/cldr-runner/blob/main/Dockerfile">Dockerfile</a> in ansible-runner
Install any additional dependencies you may have</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
THe Dockerfile resolves combined dependencies for all our Hybrid Cloud Deployments, you probably only need a subset for your environment.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_developing_within_the_runner"><a class="anchor" href="#_developing_within_the_runner"></a><a class="link" href="#_developing_within_the_runner">3.2.12. Developing within the Runner</a></h4>
<div class="paragraph">
<p>While we recommend using the Runner as your execution environment when doing development, actually developing directly against the Runner using something like Visual Studio may not be a great idea due to the file system latency commonly encountered.</p>
</div>
<div class="paragraph">
<p>Generally when the maintainers work with this system we are editing the files directly on our host system using our IDE, and those files are RW mounted into the container for execution via the <code>/runner/project</code> mechanism, which then does not noticeably incur any performance degradation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_working_with_aws_sso"><a class="anchor" href="#_working_with_aws_sso"></a><a class="link" href="#_working_with_aws_sso">3.2.13. Working with AWS SSO</a></h4>
<div class="paragraph">
<div class="title">Why:</div>
<p>Traditionally AWS users would use static keys, but more recently using temporary credentials via SSO is more commonplace.</p>
</div>
<div class="paragraph">
<p>The upside of AWS SSO is better credential management, the downside being additional complexity, reliance on the fairly awful AWSCLIv2, and a lack of OOTB automation integration.</p>
</div>
<div class="olist arabic">
<div class="title">Setup AWS SSO:</div>
<ol class="arabic">
<li>
<p>Install awscli v2 on your local machine</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">brew install awscli</code></pre>
</div>
</div>
</li>
<li>
<p>Check you have version 2 (currently 2.5.4)</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">aws --version</code></pre>
</div>
</div>
</li>
<li>
<p>Login to AWS SSO via Okta (or however), examine the list of accounts and select the one you want to set up, copy the name to use as your AWS Profile name</p>
</li>
<li>
<p>Setup and login to AWS SSO for your selected account</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">aws configure sso --profile &lt;selected name here&gt;</code></pre>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Enter your Start URL, e.g. <code><a href="https://&lt;app-name&gt;.awsapps.com/start" class="bare">https://&lt;app-name&gt;.awsapps.com/start</a></code></p>
</li>
<li>
<p>SSO Region, e.g. <code>us-east-1</code></p>
</li>
<li>
<p>It’ll launch your browser (which is why we do it on your local machine)</p>
</li>
<li>
<p>Complete the login process to authenticate the session</p>
</li>
<li>
<p>Select which AWS account you wish to set up</p>
</li>
<li>
<p>Set your default region for this profile, e.g. <code>us-east-1</code></p>
</li>
<li>
<p>Set your default output for this profile, e.g. <code>json</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>Now whenever you run a deployment you must set the profile name to match the one you have setup, e.g. in definition.yml</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">aws_profile: my-aws-profile</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You will likely have to re-login to SSO before each run
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_using_a_jumpbox"><a class="anchor" href="#_using_a_jumpbox"></a><a class="link" href="#_using_a_jumpbox">3.2.14. Using a Jumpbox</a></h4>
<div class="paragraph">
<p>A common deployment scenario is to funnel all cluster access through a jump/bastion host.</p>
</div>
<div class="paragraph">
<p>In this case, there are three possibilities:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To run the Ansible Runner from the jump host itself</p>
</li>
<li>
<p>To deploy the dependencies within the boundary of the Jump Host</p>
</li>
<li>
<p>To run the Ansible Runner locally and tunnel connections through the jump host.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In scenario 3, the following will be necessary to tunnel both SSH connection and HTTP calls through the jump host.</p>
</div>
<div class="paragraph">
<div class="title">HTTP</div>
<p>In the runner, edit <code>/runner/env/envvars</code> and add <code>http_proxy=&lt;proxy&gt;</code> where&lt;proxy&gt; is the name:port of your http proxy (e.g. a SOCKs proxy running on localhost).</p>
</div>
<div class="paragraph">
<p>Alternatively, edit quickstart.sh to pass this value through from your local machine if it is available.</p>
</div>
<div class="paragraph">
<div class="title">SSH</div>
<p>In your inventory file, under the <code>[deployment:vars]</code> group, add the following variable to set additional arguments on the SSH command used by Ansible.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ansible_ssh_common_args='-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o ProxyCommand="ssh -W %h:%p -q &lt;jump host&gt;"'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Optionally, in your SSH config file (e.g. ~/.ssh/config) you can configure an alias with predefined parameters for the jump host. This makes it easier to manage between different deployments and makes the argument string easier to read.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">Host myJump
    IdentityFile ~/.ssh/myKey
    StrictHostKeyChecking = no
    User myUser
    HostName jump.host.name</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this SSH config the proxy string would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ansible_ssh_common_args='-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o ProxyCommand="ssh -W %h:%p -q myJump"'</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_troubleshooting"><a class="anchor" href="#_troubleshooting"></a><a class="link" href="#_troubleshooting">3.3. Troubleshooting</a></h3>
<div class="sect3">
<h4 id="_ansible_vs_cloudera_cluster"><a class="anchor" href="#_ansible_vs_cloudera_cluster"></a><a class="link" href="#_ansible_vs_cloudera_cluster">3.3.1. Ansible vs cloudera.cluster</a></h4>
<div class="paragraph">
<div class="title">Can&#8217;t detect the required Python library</div>
<p>This is most commonly caused by having more than the usual number of versions of Python installed.</p>
</div>
<div class="paragraph">
<p>Very possibly you&#8217;ve ended up with 2.7, 3.6 and 3.8, or something like that, and the library you are looking for is in the wrong version.
Remove extraneous versions, figure out what is installing them and prevent it.</p>
</div>
<div class="paragraph">
<div class="title">cannot dnf install with python2</div>
<p>This usually happens when Ansible decides it simply must use /usr/bin/python even though a perfectly good python3 or other is preferred.</p>
</div>
<div class="paragraph">
<p>Most commonly this is caused by legacy Ansible python version detection where it will <strong>always</strong> use /usr/bin/python if present. This is fixed by adding <code>ansible_python_interpreter=auto</code> to all your target hosts in your inventory, such as in the <code>[deployment:vars]</code> group.</p>
</div>
</div>
<div class="sect3">
<h4 id="_credentials"><a class="anchor" href="#_credentials"></a><a class="link" href="#_credentials">3.3.2. Credentials</a></h4>
<div class="paragraph">
<div class="title">403 error from AWS</div>
<p>Could be a credential refreshing, retry to see if it’s isolated</p>
</div>
<div class="paragraph">
<div class="title">Error like: Profile given for AWS was not found.  Please fix and retry.</div>
<p>This looks to be caused when an underlying call uses authentication from boto, rather than boto3 - and boto doesn’t support the new access scheme. Find the failing Task and report it to us.</p>
</div>
<div class="paragraph">
<div class="title">The SSO session associated with this profile has expired or is otherwise invalid</div>
<p>You need to relogin</p>
</div>
<div class="paragraph">
<div class="title">no valid credential sources for Terraform AWS Provider found</div>
<p>Using Terraform for Cloudera Deploy, this typically means your SSO token has expired, relogin to continue</p>
</div>
<div class="paragraph">
<div class="title">WSL2 - Browser does not launch</div>
<p>The browser may not open during the aws configure sso command if you have the DISPLAY environment variable set in WSL2. This is likely to happen if you run Linux GUI applications in WSL and don&#8217;t have a browser installed in the WSL distribution.</p>
</div>
<div class="paragraph">
<p>The quick fix in this case is to unset DISPLAY and re-run the SSO configure command.</p>
</div>
</div>
<div class="sect3">
<h4 id="_general_troubleshooting"><a class="anchor" href="#_general_troubleshooting"></a><a class="link" href="#_general_troubleshooting">3.3.3. General Troubleshooting</a></h4>
<div class="paragraph">
<div class="title">docker: Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?</div>
<p>You need to enable WSL integration in the Docker Desktop settings for Resources &gt; WSL Integration</p>
</div>
<div class="paragraph">
<div class="title">SSH_AUTH_SOCK is empty or not set, unable to proceed. Exiting</div>
<p>Run the following command to activate the ssh-agent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>eval `ssh-agent -s`</pre>
</div>
</div>
<div class="paragraph">
<p>If that command doesn&#8217;t work, try</p>
</div>
<div class="listingblock">
<div class="content">
<pre>eval "$(ssh-agent)"</pre>
</div>
</div>
<div class="paragraph">
<div class="title">docker: Error response from daemon: invalid mount config for type "bind": field Source must not be empty.</div>
<p>Probably your SSH_AUTH_SOCK is not populated from the ssh-agent. Same fix as above.</p>
</div>
<div class="paragraph">
<div class="title">The path /private/tmp/com.apple.launchd.[some random sting]/Listeners is not shared from the host and is not known to Docker.</div>
<p>You need to add you /private directory to the file sharing in your Docker settings for Resources &gt; File Sharing</p>
</div>
<div class="paragraph">
<div class="title">GPG Signing is failing for my git commits</div>
<p>Could be lots of reasons, start by doing a commit on cmdline with <code>GIT_TRACE=1</code> set to see the specific error.</p>
</div>
<div class="paragraph">
<p>A common cause is your GPG Key expiring, to fix this on OSX:
. comment out no-tty in ~/.gnupg/gpg.conf
. Follow <a href="https://stackoverflow.com/a/43728576/4717963">this process</a> on SO to reset your key expiry
. Re-enable no-tty</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cdPrivate"><a class="anchor" href="#cdPrivate"></a><a class="link" href="#cdPrivate">3.4. CDP Private Cloud Deployments</a></h3>
<div class="paragraph">
<p>CDP Base represents deployment of 'Traditional' clusters via Cloudera Manager, which you might think of historically as hadoop or big data clusters. In practice, there is an Ansible Collection called <code>cloudera.cluster</code> which is excellent at configuring Cloudera Manager across various versions of Linux regardless of whether that OS is running in Containers, Virtual Machines, Cloud Infra like EC2, or old school baremetal nodes.</p>
</div>
<div class="paragraph">
<p>Cloudera.cluster is wrapped within Cloudera-Deploy, so again in practice you are most likely to simply use Cloudera-Deploy as the entrypoint to drive <code>cloudera.cluster</code> to create the cluster you want via the Definition mechanism explained in these docs.</p>
</div>
<div class="paragraph">
<p>The differences are that Cloudera.cluster has been built over many generations to support Cloudera Manager versions 5 to 7, and supports many legacy options and behaviors for user convenience. The result of this is that, while simple deployments are as simple as the more modern CDP Public Cloud, complex deployments will require a greater familiarity with Ansible and Cloudera Manager templates.</p>
</div>
<div class="sect3">
<h4 id="_ansible_controller_options"><a class="anchor" href="#_ansible_controller_options"></a><a class="link" href="#_ansible_controller_options">3.4.1. Ansible Controller options</a></h4>
<div class="paragraph">
<p>We still strongly recommend that you use the cloudera-runner Docker Container shipped with Cloudera-Deploy as your Ansible controller for CDP Base deployments, because the consistency and logging is going to save you time and effort.</p>
</div>
<div class="paragraph">
<p>However, it is not uncommon to use the target Cloudera Manager node as the Controller. It is also not uncommon to need to deploy to air-gapped environments or environments where Docker is not permitted.</p>
</div>
<div class="paragraph">
<p>As such, there is a <a href="https://github.com/cloudera-labs/cloudera-deploy/blob/main/centos7-init.sh">script</a> for deploying the dependencies for Cloudera-Deploy on centos7 as an example in the repo for Power Users in these scenarios. Note that the script covers dependencies for all Cloudera Products on all current Clouds, so you may wish to exclude parts irrelevant to your scenario.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It is worth noting that the <code>admin_password</code> field from your Profile, as outlined in the Quickstart, will be used as the Cloudera Manager admin password during <code>cloudera.cluster</code> deployments.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_inventories"><a class="anchor" href="#_inventories"></a><a class="link" href="#_inventories">3.4.2. Inventories</a></h4>
<div class="paragraph">
<p>An inventory file can be supplied using the traditional -i flag at runtime or by including either
inventory_static.ini or inventory_template.ini in the definitions path.</p>
</div>
<div class="paragraph">
<div class="title">inventory_static.ini</div>
<p>An Ansible inventory covering the hosts in-scope for the deployment. An inventory with this name will be picked up automatically if present without using the <code>-i</code> to specify the inventory file at runtime.</p>
</div>
<div class="paragraph">
<p>Common inventory group names are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cloudera_manager</p>
</li>
<li>
<p>cluster_master_nodes</p>
</li>
<li>
<p>cluster_worker_nodes</p>
</li>
<li>
<p>cluster_edge_nodes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each host in these groups should be assigned one of the host templates that is defined in cluster.yml. These can be applied per host by setting <code>host_template=TemplateName</code> after the hostname, or per group by setting <code>host_template=TemplateName</code> in the group vars. See <a href="https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html#adding-variables-to-inventory">here</a> for more information on Ansible inventory vars.</p>
</div>
<div class="paragraph">
<p>Nodes that should be added to the CDP Cluster as defined in the cluster.yml must be added as children to the <code>cluster</code> group. For example, if all data nodes are present under the <code>cluster_worker_nodes</code> group, then this group should be listed under <code>cluster:children</code>. See <a href="https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html#inheriting-variable-values-group-variables-for-groups-of-groups">here</a> for an example of setting group children.</p>
</div>
<div class="paragraph">
<p>All nodes/groups should be added as children of the <code>deployment</code> group <code>[deployment:children]</code>. This includes the <code>cluster</code> group, as well as all non-CDP Cluster groups, for example, Cloudera Manager and supporting infrastructure nodes, perhaps running HAProxy or an RDBMS, that are deployed with the cluster but are not running CDP Roles. This allows for deployment-wide variables to be set, such as the common ssh key that can be used to access all nodes.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Do not use the <code>[all:vars]</code> group if you are using an independent Ansible Controller as Plays will also be applied to it via the <code>localhost</code> mechanic. This includes from your Laptop or the Ansible-Runner supplied in Cloudera-Deploy.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_process_overview"><a class="anchor" href="#_process_overview"></a><a class="link" href="#_process_overview">3.4.3. Process Overview</a></h4>
<div class="paragraph">
<p>In this section we will walk through a typical deployment, commenting on options at various points</p>
</div>
<div class="sect4">
<h5 id="_1_prepare_a_definition_path"><a class="anchor" href="#_1_prepare_a_definition_path"></a><a class="link" href="#_1_prepare_a_definition_path">1. Prepare a Definition Path</a></h5>
<div class="paragraph">
<p>You are advised to create a working directory for your definition in your preferred Projects directory.</p>
</div>
<div class="paragraph">
<p>If you have checked out Cloudera-Deploy from Github following the Quickstart, then you could make a copy of the folder <code>cloudera-deploy/examples/sandbox</code> into the same base code Projects directory, and use it as a starting point.</p>
</div>
<div class="listingblock">
<div class="title">You might then have:</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">~/Projects/cloudera-deploy  # contains quickstart.sh, main.yml
~/Projects/my-definition  # copied from ~/Projects/cloudera-deploy/examples/sandbox</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_2_infrastructure_and_inventory"><a class="anchor" href="#_2_infrastructure_and_inventory"></a><a class="link" href="#_2_infrastructure_and_inventory">2. Infrastructure and Inventory</a></h5>
<div class="paragraph">
<p>You are advised to prepare your nodes in advance by whatever mechanism you prefer, and then include them in an Ansible Inventory matching the shape of the Cluster you want to deploy.</p>
</div>
<div class="paragraph">
<p>You may use Cloudera-Deploy to automatically provision EC2 instances based on the inventory template, but this is intended for test and training purposes. An example inventory template is included in the <a href="https://github.com/cloudera-labs/cloudera-deploy/blob/main/examples/sandbox/inventory_template.ini">Cloudera-Deploy Sandbox Example</a>. There is also a copy of the <code>static_inventory.ini</code> file in this directory.</p>
</div>
<div class="paragraph">
<p>If you want to use a static inventory, you may use any of the typical Ansible inventory approaches such as <code>-i</code> on the cmdline, the Inventory path, or including a file <code>inventory_static.ini</code> in your Definition Path which Cloudera-Deploy will automatically pick up.</p>
</div>
<div class="paragraph">
<p>You may wish to include additional variables in the Inventory, most typically the ssh user and private key. These should probably be in the <code>[deployment:vars]</code> section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">[deployment:vars]
ansible_ssh_private_key_file=~/.ssh/root_key
ansible_user=root</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When you run quickstart.sh to launch the Runner Container, it will mount your local user <code>~/.ssh</code> directory into the container, so there is no need to copy keys around provided you use bash expansion for the user home directory.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_3_cloudera_deploy_and_the_runner"><a class="anchor" href="#_3_cloudera_deploy_and_the_runner"></a><a class="link" href="#_3_cloudera_deploy_and_the_runner">3. Cloudera-Deploy and the Runner</a></h5>
<div class="paragraph">
<p>If you have not already done so, you should follow the instructions to setup your OS dependencies and get a copy of Cloudera-Deploy. New users are encouraged to use the <a href="https://github.com/cloudera-labs/cloudera-deploy/blob/main/readme.adoc">Quickstart</a>, while Power Users who want to immediately understand the inner workings may wish to follow selected parts of the <a href="developers.html#_detailed_setup_for_developers">Developers</a> guide.</p>
</div>
<div class="paragraph">
<p>Regardless of which method you select, complete the setup process until you are in the orange coloured interactive shell. Ensure that /runner/project within the shell has mounted your Projects directory that contains the Definition working directory you created in step one.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
At this point you should ensure that the directory listing in <code>/runner/project</code> within the Runner matches your projects directory on your local machine, we earlier gave the example of <code>~/Projects</code> for this.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When using the Ansible Runner, you should be aware that most changes to the filesystem within the <strong>container</strong> are not persistent - that is, when you kill the container, most changes will be lost. When we are working on files that we want to persist, such as cluster templates, we can keep these on the local filesystem outside of the container, and mount the local filesystem directory inside the container, which is the purpose of the /runner/project mountpoint. This means that we can read and write to those files both inside and outside of the container and you can safely terminate your container without losing them.</p>
</div>
<div class="paragraph">
<p>Apart from the working dir, the container will mount specific directories out of your local user profile such as ~/.ssh, ~/.config, ~/.aws etc. into the container to pass-through credentials and other requirements. You should assume that any changes outside of these profile directories and /runner/project are not persisted.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If we do not specify which directory to mount, the quickstart.sh script will mount the parent directory that the current session is in. i.e. if you run quickstart.sh from the path <code>~/Projects/cloudera-deploy</code>, then <code>~/Projects</code> in the host filesystem will be mounted to <code>/runner/projects</code> in the Container.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you did not stop the container previously, quickstart.sh will ignore any arguments passed and simply give you a new terminal session in the existing container. Therefore, if you want to change the mounted directory you must stop and restart the container with the new path.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_executing_playbooks"><a class="anchor" href="#_executing_playbooks"></a><a class="link" href="#_executing_playbooks">3.4.4. Executing Playbooks</a></h4>
<div class="paragraph">
<p>To run the playbook, we use the <code>ansible-playbook</code> command. The entry point to the playbook is in main.yml in cloudera-deploy. With our mount point in /runner/project, the full path is <code>/runner/project/cloudera-deploy/main.yml</code>. This is passed as the first argument to ansible-playbook.</p>
</div>
<div class="paragraph">
<p>We also need to provide some additional arguments. We do this with the -e flag. The first argument to pass is the definition_path. This is the path to the directory that contains our definition, inventory, etc.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It is usually a good idea to use Cloudera-Deploy to verify your infrastructure before committing to the full deployment, by using the same main playbook and adding the ‘verify’ tag, as below. This is particularly handy for real-world deployments for a quick sanity check.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An example command is shown below. Notice that we do not need to specifically provide an inventory list. The playbook will look in the definition_path for an inventory file, which is included in the cloudera-deploy-definitions examples. Of course, you can provide an inventory file using the -i if you want.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Commands like <code>ansible-playbook</code> should be run from the <code>/runner</code> directory in the Ansible-Runner to pick up the defaults and other useful configurations
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ansible-playbook /runner/project/cloudera-deploy/main.yml \
 -e "definition_path=/runner/project/my-definition/" \
 -t verify
 -v</code></pre>
</div>
</div>
<div class="paragraph">
<p>Following this will be a lot of output into the terminal which tracks the stages of our deployment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">PLAY [Init Cloudera-Deploy Run] ******************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] ***************************************************************************************************************************************************************************************************************************************
Thursday 13 May 2021  18:54:13 +0000 (0:00:00.014)   	0:00:00.014 **********
ok: [localhost]
…...</code></pre>
</div>
</div>
<div class="paragraph">
<p>To run the actual full deployment against your inventory, the most common tag to use is <code>full_cluster</code>. The complete listing of all tags can be found by reviewing the Plays in <a href="https://github.com/cloudera-labs/cloudera-deploy/blob/main/cluster.yml">cluster.yml</a> in cloudera-deploy.</p>
</div>
<div class="listingblock">
<div class="title">The command would look something like this, with verbosity at level 2</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ansible-playbook /runner/project/cloudera-deploy/main.yml \
 -e "definition_path=/runner/project/my-definition/" \
 -t full_cluster
 -vv</code></pre>
</div>
</div>
<div class="paragraph">
<p>Expect the deployment to take 30 to 90 minutes or longer, assuming you encounter no errors.</p>
</div>
<div class="paragraph">
<p>If you do run into issues, most runs are idempotent so you can re-run with increased verbosity of the terminal output by adding the ‘-v’ flag to the ansible-playbook command. You can scale the verbosity by adding more v’s up to ‘-vvvvv’ for maximum verbosity.</p>
</div>
<div class="paragraph">
<p>There is nothing you need to do until the playbook completes, however it can be useful to have a scroll through the output and get a feel for what it is doing.</p>
</div>
<div class="paragraph">
<p>Eventually, you will get to some output that looks like the following. This indicates that Cloudera Manager is being installed, and then a check runs to wait for the server to start responding. When you get past this step, you’ll be able to access the CM UI in your browser.</p>
</div>
<div class="paragraph">
<p>It will be installed on the host that was under the cloudera_manager title in your inventory, and on port 7180 for HTTP and 7183 for HTTPS. The username is typically 'admin', and the password will be the admin_password you set in your Profile or Definition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">TASK [cloudera.cluster.server : Install Cloudera Manager Server] *********************************************************************************************************************************************************************************************
Thursday 13 May 2021  19:41:50 +0000 (0:00:06.555)   	0:47:36.812 **********
….
RUNNING HANDLER [cloudera.cluster.common : wait cloudera-scm-server] *****************************************************************************************************************************************************************************************
Thursday 13 May 2021  19:42:45 +0000 (0:00:09.338)   	0:48:31.682 **********</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next important step to watch out for comes right at the end of the playbook. This is the Import Cluster Template step. In this step, the playbook is using the CM API to insert our cluster template, which allows CM to handle the complex logic of deploying the software, pushing out configurations and completing initializations and first runs. During this step, you will not see much useful output in the terminal.</p>
</div>
<div class="paragraph">
<p>Instead, you should go inside the CM web UI and go to the ‘Running Commands’ page, where you will be able to drill down into the ‘Import Cluster Template’ command and watch the individual steps that CM performs. This is the best place to debug any errors that you might encounter during the Import Cluster Template step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">TASK [cloudera.cluster.cluster : Import cluster template]
******************************************************</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Deploying parcels can take some time if downloading directly from Cloudera Repos over slow or long-distance connections. Consider using the local repo options if doing multiple builds.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After the Template is imported, the First Run is completed, and then a cluster Restart command will run.</p>
</div>
<div class="paragraph">
<p>In the terminal session, our playbook has now completed and we will see the results at the end of the output. We should see a success message and a quick recap of the steps it took.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">TASK [Deployment results] ***************************************************************************************************************
Thursday 13 May 2021  20:59:45 +0000 (0:00:00.287)   	2:05:31.793 **********
ok: [localhost] =&gt; {
	"msg": "Success!"
}

PLAY RECAP ***************************************************************************************************************
ccycloud-1.cddemo.root.hwx.site : ok=162  changed=49   unreachable=0	failed=0	skipped=151  rescued=0	ignored=0
ccycloud-2.cddemo.root.hwx.site : ok=71   changed=23   unreachable=0	failed=0	skipped=65   rescued=0	ignored=0
ccycloud-3.cddemo.root.hwx.site : ok=71   changed=23   unreachable=0	failed=0	skipped=65   rescued=0	ignored=0
ccycloud-4.cddemo.root.hwx.site : ok=71   changed=23   unreachable=0	failed=0	skipped=65   rescued=0	ignored=0
localhost              	: ok=173  changed=11   unreachable=0	failed=0	skipped=149  rescued=0	ignored=1

Thursday 13 May 2021  20:59:45 +0000 (0:00:00.064)   	2:05:31.857 **********
===============================================================================
cloudera.cluster.cluster : Import cluster template --------------------------------- 4132.25s
cloudera.cluster.daemons : Install Cloudera Manager daemons package ---------------- 1415.92s
cloudera.cluster.user_accounts : Create local user accounts ------------------------ 294.11s
cloudera.cluster.user_accounts : Set home directory permissions -------------------- 254.82s
cloudera.cluster.common : wait cloudera-scm-server --------------------------------- 99.33s
cloudera.cluster.agent : Install Cloudera Manager agent packages ------------------- 64.32s
cloudera.cluster.os : Populate service facts --------------------------------------- 60.19s
cloudera.cluster.jdk : Install JDK ------------------------------------------------- 50.16s
cloudera.cluster.krb5_server : Install KRB5 server --------------------------------- 39.23s
geerlingguy.postgresql : Ensure PostgreSQL packages are installed. ----------------- 38.81s
cloudera.cluster.cluster : Restart Cloudera Management Service --------------------- 35.66s
cloudera.cluster.mgmt : Start Cloudera Management Service -------------------------- 34.83s
cloudera.cluster.krb5_client : Install KRB5 client libraries ----------------------- 34.25s
cloudera.cluster.kerberos : Import KDC admin credentials --------------------------- 25.34s
Gather facts from connected inventory ---------------------------------------------- 20.92s
cloudera.cluster.krb5_server : Start Kerberos KDC ---------------------------------- 19.53s
cloudera.cluster.deployment/repometa : Download parcel manifest information -------- 19.00s
cloudera.cluster.os : Install rngd ------------------------------------------------- 18.34s
cloudera.cluster.rdbms : Copy SQL to change template to UTF-8 ---------------------- 16.64s
Gathering Facts -------------------------------------------------------------------- 16.31s
cldr base-v1.0.2 #&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>From this, we can see that the build took 2:05:31.793 (2 hours 5 minutes) in total, around 1 hour of this was the Import Cluster Template which includes the parcel downloads. Pre-downloading and hosting a cluster-local parcel repository can speed this up dramatically.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Contributing"><a class="anchor" href="#Contributing"></a><a class="link" href="#Contributing">3.5. Contributing to these Docs</a></h3>
<div class="paragraph">
<p>Contributions to improve the docs are welcomed at any time. <br>
We encourage you to either directly create a PR for the changes, or open an Issue on Github.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">In order to contribute your changes, please consider the following process</dt>
<dd>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Fork the repo to your Github account, and create a branch for your changes</p>
</li>
<li>
<p>Make your edits in your checked out copy</p>
</li>
<li>
<p><a href="https://asciidoctor.org/#installation">Install</a> AsciiDoctor locally to build and check your changes</p>
</li>
<li>
<p>(Optional) <a href="https://formulae.brew.sh/formula/make">Install</a> Make to use the Makefile for convenient builds</p>
</li>
<li>
<p>Build the index.html root using <code>make</code> in the repository root</p>
</li>
<li>
<p>Review the docs by opening index.html in your browser</p>
</li>
<li>
<p>Create a PR to <code>main</code> with your changes when they are ready for publication</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>← Previous: <a href="_learning_oriented_training.html">Learning-oriented Training</a> | ↑ Up: <a href="README.html">Documentation for Cloudera-Labs</a> | Next: <a href="_information_oriented_references.html">Information-oriented References</a> →</p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-05-06 10:57:24 UTC
</div>
</div>
</body>
</html>